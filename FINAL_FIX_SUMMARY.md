# æœ€ç»ˆä¿®å¤æ–¹æ¡ˆæ€»ç»“

## é—®é¢˜è¯Šæ–­

æ‚¨é‡åˆ°çš„æ ¸å¿ƒé—®é¢˜æ˜¯ï¼š**pnpm å‘½ä»¤æ‰¾ä¸åˆ°**

```
./update-standalone.sh: line 14: pnpm: command not found
è„šæœ¬æ‰§è¡Œå¤±è´¥ (é€€å‡ºç : 127)
```

### ä¸ºä»€ä¹ˆä¼šè¿™æ ·ï¼Ÿ

1. **äº¤äº’å¼ vs éäº¤äº’å¼ Shell**
   - å½“ä½  SSH ç™»å½•åæ‰‹åŠ¨è¿è¡Œå‘½ä»¤ï¼Œä½¿ç”¨çš„æ˜¯**äº¤äº’å¼ shell**
   - äº¤äº’å¼ shell ä¼šåŠ è½½ `.bashrc` å’Œ `.bash_profile`ï¼Œæ‰€ä»¥ `pnpm --version` èƒ½æ­£å¸¸å·¥ä½œ
   - ä½†é€šè¿‡ SSH è¿œç¨‹æ‰§è¡Œè„šæœ¬æ—¶ï¼Œä½¿ç”¨çš„æ˜¯**éäº¤äº’å¼ shell**
   - éäº¤äº’å¼ shell åªæœ‰æœ€åŸºæœ¬çš„ PATHï¼ˆé€šå¸¸åªæœ‰ `/usr/bin:/bin`ï¼‰

2. **PATH è®¾ç½®é—®é¢˜**
   - ä½ çš„è„šæœ¬ä¸­å†™äº†: `export PATH="/home/ai4news/.local/share/pnpm:..."`
   - ä½† pnpm å¯èƒ½ä¸åœ¨è¿™ä¸ªè·¯å¾„ï¼Œå®ƒå¯èƒ½åœ¨ï¼š
     - nvm ç®¡ç†çš„ Node.js ç›®å½•
     - npm å…¨å±€ç›®å½•
     - å…¶ä»–è‡ªå®šä¹‰ä½ç½®

3. **set -e ç«‹å³é€€å‡º**
   - è„šæœ¬ç¬¬äºŒè¡Œ `set -e` æ„å‘³ç€ä»»ä½•å‘½ä»¤å¤±è´¥å°±ç«‹å³é€€å‡º
   - æ‰€ä»¥å½“ pnpm æ‰¾ä¸åˆ°æ—¶ï¼Œè„šæœ¬ç«‹å³åœæ­¢

---

## è§£å†³æ–¹æ¡ˆ

æˆ‘åˆ›å»ºäº† **3 ä¸ªæ–°æ–‡ä»¶** æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼š

### 1. `update-standalone-v2.sh` â­ æ¨èä½¿ç”¨

**è¿™æ˜¯ä»€ä¹ˆï¼Ÿ**
- æ™ºèƒ½ç‰ˆæœ¬çš„éƒ¨ç½²è„šæœ¬
- è‡ªåŠ¨æŸ¥æ‰¾ pnpm çš„ä½ç½®
- å¦‚æœæ‰¾ä¸åˆ° pnpmï¼Œè‡ªåŠ¨ä½¿ç”¨ npm
- æ˜¾ç¤ºè¯¦ç»†çš„è¯Šæ–­ä¿¡æ¯

**å®ƒåšäº†ä»€ä¹ˆï¼Ÿ**
```bash
1. åŠ è½½æ‰€æœ‰ç¯å¢ƒé…ç½®æ–‡ä»¶ (.bashrc, .bash_profile, .profile)
2. åœ¨ 7 ä¸ªå¸¸è§ä½ç½®æœç´¢ pnpm:
   - /home/ai4news/.local/share/pnpm
   - /home/ai4news/.npm-global/bin
   - /usr/local/bin
   - /usr/bin
   - $HOME/.local/share/pnpm
   - $HOME/.nvm/versions/node/*/bin
   - $HOME/.config/pnpm
3. å¦‚æœéƒ½æ²¡æ‰¾åˆ°ï¼Œæ£€æŸ¥ npm æ˜¯å¦å¯ç”¨
4. æ˜¾ç¤ºç¯å¢ƒä¿¡æ¯ï¼ˆå·¥ä½œç›®å½•ã€Nodeç‰ˆæœ¬ã€pnpmç‰ˆæœ¬ï¼‰
5. æ‰§è¡Œ 5 æ­¥éƒ¨ç½²æµç¨‹:
   - æ‹‰å–ä»£ç 
   - å®‰è£…ä¾èµ–
   - æ•°æ®åº“è¿ç§»
   - æ„å»ºé¡¹ç›®
   - é‡å¯ PM2
```

### 2. `find-pnpm.sh` ğŸ” è¯Šæ–­å·¥å…·

**è¿™æ˜¯ä»€ä¹ˆï¼Ÿ**
- è¯Šæ–­è„šæœ¬ï¼Œå¸®ä½ æ‰¾åˆ° pnpm çš„ç¡®åˆ‡ä½ç½®

**å®ƒæ˜¾ç¤ºä»€ä¹ˆä¿¡æ¯ï¼Ÿ**
- å½“å‰çš„ç¯å¢ƒå˜é‡
- pnpm æ˜¯å¦åœ¨ PATH ä¸­
- æœç´¢æ‰€æœ‰å¯èƒ½çš„ pnpm ä½ç½®
- Node.js å’Œ npm çš„ä¿¡æ¯
- .bashrc ä¸­çš„ PATH è®¾ç½®

**ä½•æ—¶ä½¿ç”¨ï¼Ÿ**
- å¦‚æœ v2 è„šæœ¬è¿˜æ˜¯ä¸å·¥ä½œ
- æƒ³äº†è§£ pnpm çš„ç¡®åˆ‡ä½ç½®
- è°ƒè¯•ç¯å¢ƒé—®é¢˜

### 3. `QUICK_FIX.bat` / `QUICK_FIX.sh` ğŸš€ ä¸€é”®éƒ¨ç½²

**è¿™æ˜¯ä»€ä¹ˆï¼Ÿ**
- è‡ªåŠ¨åŒ–è„šæœ¬ï¼Œä¸€æ¬¡æ€§å®Œæˆæ‰€æœ‰ä¿®å¤

**å®ƒåšäº†ä»€ä¹ˆï¼Ÿ**
1. ä¸Šä¼  `update-standalone-v2.sh` åˆ°æœåŠ¡å™¨
2. ä¸Šä¼  `find-pnpm.sh` åˆ°æœåŠ¡å™¨
3. è®¾ç½®æ‰§è¡Œæƒé™
4. è¿è¡Œè¯Šæ–­è„šæœ¬æ˜¾ç¤ºç³»ç»Ÿä¿¡æ¯

---

## å¿«é€Ÿä¿®å¤æ­¥éª¤ï¼ˆ3 æ­¥ï¼‰

### ç¬¬ 1 æ­¥ï¼šè¿è¡Œä¸€é”®ä¿®å¤è„šæœ¬

**Windows:**
```cmd
cd D:\05 Codes\Other Codes\consensuslab\deploy-interface
QUICK_FIX.bat
```

**Linux/Mac:**
```bash
cd deploy-interface
./QUICK_FIX.sh
```

è¿™ä¼šè‡ªåŠ¨ä¸Šä¼ æ‰€æœ‰éœ€è¦çš„æ–‡ä»¶å¹¶è¿è¡Œè¯Šæ–­ã€‚

### ç¬¬ 2 æ­¥ï¼šæŸ¥çœ‹è¯Šæ–­è¾“å‡º

è„šæœ¬ä¼šæ˜¾ç¤º pnpm çš„ä½ç½®ä¿¡æ¯ã€‚ä¾‹å¦‚ï¼š

```
âœ… pnpm å¯ç”¨
ä½ç½®: /home/ai4news/.nvm/versions/node/v18.16.0/bin/pnpm
ç‰ˆæœ¬: 10.4.1
```

æˆ–è€…ï¼š

```
âŒ pnpm ä¸åœ¨ PATH ä¸­
æœç´¢å¸¸è§ä½ç½®:
   âœ“ å­˜åœ¨: /home/ai4news/.nvm/versions/node/v18.16.0/bin
      â†’ pnpm å¯æ‰§è¡Œæ–‡ä»¶åœ¨æ­¤
```

### ç¬¬ 3 æ­¥ï¼šæ›´æ–°é…ç½®å¹¶é‡å¯

`.env` æ–‡ä»¶å·²ç»è‡ªåŠ¨æ›´æ–°ä¸ºï¼š
```env
DEPLOY_SCRIPT=./update-standalone-v2.sh
```

ç°åœ¨é‡å¯éƒ¨ç½²æœåŠ¡ï¼š

**åœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œï¼š**
```bash
cd ~/Sen_Li/consensuslab/deploy-interface
pkill -f "python.*deploy.py"
python3 deploy.py
```

æˆ–è€…ç”¨ nohup åœ¨åå°è¿è¡Œï¼š
```bash
cd ~/Sen_Li/consensuslab/deploy-interface
pkill -f "python.*deploy.py"
nohup python3 deploy.py > deploy.log 2>&1 &
```

---

## æµ‹è¯•éƒ¨ç½²

1. **è®¿é—®éƒ¨ç½²ç•Œé¢**
   ```
   http://10.218.163.144:5000
   ```

2. **ç‚¹å‡»"å¼€å§‹éƒ¨ç½²"æŒ‰é’®**

3. **è§‚å¯Ÿæ—¥å¿—è¾“å‡º**ï¼Œåº”è¯¥çœ‹åˆ°ï¼š

```
ğŸ” åŠ è½½ç¯å¢ƒé…ç½®...
ğŸ” æŸ¥æ‰¾ pnpm...
âœ… æ‰¾åˆ° pnpm: /home/ai4news/.nvm/versions/node/v18.16.0/bin/pnpm

ğŸ“‹ ç¯å¢ƒä¿¡æ¯:
   å·¥ä½œç›®å½•: /home/ai4news/Sen_Li/consensuslab
   Node ç‰ˆæœ¬: v18.16.0
   pnpm ç‰ˆæœ¬: 10.4.1
   npm ç‰ˆæœ¬: 8.19.2

ğŸ“¥ æ­¥éª¤ 1/5: è·å–æœ€æ–°ä»£ç ...
âœ… ä»£ç æ›´æ–°å®Œæˆ

ğŸ“¦ æ­¥éª¤ 2/5: å®‰è£…ä¾èµ–...
âœ… ä¾èµ–å®‰è£…å®Œæˆ

ğŸ—„ï¸  æ­¥éª¤ 3/5: æ•°æ®åº“è¿ç§»...
âœ… æ•°æ®åº“æ£€æŸ¥å®Œæˆ

ğŸ”¨ æ­¥éª¤ 4/5: æ„å»ºé¡¹ç›®...
âœ… æ„å»ºå®Œæˆ

ğŸ”„ æ­¥éª¤ 5/5: é‡å¯æœåŠ¡...
âœ… æœåŠ¡é‡å¯å®Œæˆ

ğŸ“Š å½“å‰çŠ¶æ€:
â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ id  â”‚ name             â”‚ status  â”‚ cpu     â”‚ memory   â”‚
â”œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 0   â”‚ consensuslab     â”‚ online  â”‚ 0.2%    â”‚ 145.2mb  â”‚
â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸ‰ éƒ¨ç½²æˆåŠŸï¼
```

4. **çœ‹åˆ°æˆåŠŸæ¶ˆæ¯**
   - æµè§ˆå™¨ä¼šæ˜¾ç¤ºç»¿è‰²çš„ "ğŸ‰ ä¸€é”®éƒ¨ç½²æˆåŠŸï¼" æ¨ªå¹…

---

## å¦‚æœè¿˜æ˜¯ä¸å·¥ä½œ

### æ–¹æ¡ˆ A: æ‰‹åŠ¨è¿è¡Œè¯Šæ–­

```bash
# SSH åˆ°æœåŠ¡å™¨
ssh ai4news@10.218.163.144

# è¿è¡Œè¯Šæ–­è„šæœ¬
cd ~/Sen_Li/consensuslab
./find-pnpm.sh

# æŸ¥çœ‹è¾“å‡ºï¼Œæ‰¾åˆ° pnpm çš„ä½ç½®
```

### æ–¹æ¡ˆ B: ä½¿ç”¨å®Œæ•´è·¯å¾„

å¦‚æœä½ çŸ¥é“ pnpm çš„ç¡®åˆ‡ä½ç½®ï¼ˆæ¯”å¦‚ä»è¯Šæ–­è¾“å‡ºä¸­çœ‹åˆ°ï¼‰ï¼Œå¯ä»¥ç›´æ¥åœ¨è„šæœ¬ä¸­ä½¿ç”¨å®Œæ•´è·¯å¾„ï¼š

```bash
# åœ¨æœåŠ¡å™¨ä¸Šç¼–è¾‘è„šæœ¬
ssh ai4news@10.218.163.144
cd ~/Sen_Li/consensuslab
nano update-standalone-v2.sh

# åœ¨è„šæœ¬é¡¶éƒ¨æ·»åŠ ï¼ˆä½¿ç”¨ä½ æ‰¾åˆ°çš„è·¯å¾„ï¼‰:
PNPM=/home/ai4news/.nvm/versions/node/v18.16.0/bin/pnpm

# ç„¶åå°†æ‰€æœ‰ pnpm å‘½ä»¤æ”¹ä¸º $PNPM
# ä¾‹å¦‚: pnpm install -> $PNPM install
```

### æ–¹æ¡ˆ C: ä½¿ç”¨ npm æ›¿ä»£

å¦‚æœå®åœ¨æ‰¾ä¸åˆ° pnpmï¼Œå¯ä»¥ç”¨ npmï¼š

ç¼–è¾‘ `update-standalone-v2.sh`ï¼Œåœ¨é¡¶éƒ¨æ·»åŠ ï¼š
```bash
alias pnpm='npm'
```

---

## æ–‡ä»¶æ¸…å•

| æ–‡ä»¶ | ä½ç½® | è¯´æ˜ |
|------|------|------|
| `update-standalone-v2.sh` | é¡¹ç›®æ ¹ç›®å½• | æ–°ç‰ˆæ™ºèƒ½éƒ¨ç½²è„šæœ¬ â­ |
| `find-pnpm.sh` | é¡¹ç›®æ ¹ç›®å½• | pnpm ä½ç½®è¯Šæ–­è„šæœ¬ |
| `QUICK_FIX.bat` | deploy-interface/ | Windows ä¸€é”®ä¿®å¤ |
| `QUICK_FIX.sh` | deploy-interface/ | Linux/Mac ä¸€é”®ä¿®å¤ |
| `PNPM_FIX_GUIDE.md` | é¡¹ç›®æ ¹ç›®å½• | è¯¦ç»†ä¿®å¤æŒ‡å— |
| `FINAL_FIX_SUMMARY.md` | é¡¹ç›®æ ¹ç›®å½• | æœ¬æ–‡æ¡£ |

---

## æ¶æ„å¯¹æ¯”

### ä¹‹å‰ï¼ˆæœ‰é—®é¢˜ï¼‰

```
Deploy Interface
    â†“
SSH: bash -l -c './update-standalone.sh'
    â†“
Script: export PATH="å›ºå®šè·¯å¾„"
    â†“
pnpm install â† âŒ æ‰¾ä¸åˆ° pnpm
```

### ç°åœ¨ï¼ˆå·²ä¿®å¤ï¼‰

```
Deploy Interface
    â†“
SSH: bash -l -c './update-standalone-v2.sh'
    â†“
Script: source .bashrc .bash_profile
    â†“
Script: æœç´¢ 7 ä¸ªå¯èƒ½çš„ä½ç½®
    â†“
Script: æ‰¾åˆ° pnpm æˆ–ä½¿ç”¨ npm æ›¿ä»£
    â†“
pnpm install â† âœ… æ­£å¸¸å·¥ä½œ
```

---

## æŠ€æœ¯ç»†èŠ‚

### ä¸ºä»€ä¹ˆ v2 è„šæœ¬æ›´å¥½ï¼Ÿ

1. **å¤šè·¯å¾„æœç´¢**
   ```bash
   PNPM_LOCATIONS=(
       "/home/ai4news/.local/share/pnpm"
       "/home/ai4news/.npm-global/bin"
       "/usr/local/bin"
       "/usr/bin"
       "$HOME/.local/share/pnpm"
       "$HOME/.nvm/versions/node/*/bin"  # æ”¯æŒé€šé…ç¬¦
       "$HOME/.config/pnpm"
   )
   ```

2. **æ™ºèƒ½é™çº§**
   ```bash
   if pnpm ä¸åœ¨ PATH; then
       æœç´¢å¸¸è§ä½ç½®
       if è¿˜æ˜¯æ‰¾ä¸åˆ°; then
           ä½¿ç”¨ npm ä½œä¸ºæ›¿ä»£
           if npm ä¹Ÿæ²¡æœ‰; then
               æ˜¾ç¤ºé”™è¯¯å¹¶é€€å‡º
           fi
       fi
   fi
   ```

3. **è¯¦ç»†è¯Šæ–­**
   ```bash
   echo "ğŸ“‹ ç¯å¢ƒä¿¡æ¯:"
   echo "   å·¥ä½œç›®å½•: $(pwd)"
   echo "   Node ç‰ˆæœ¬: $(node --version)"
   echo "   pnpm ç‰ˆæœ¬: $(pnpm --version)"
   ```

---

## å¸¸è§é—®é¢˜

### Q: ä¸ºä»€ä¹ˆä¸ç›´æ¥ç”¨ npmï¼Ÿ

**A:** é¡¹ç›®çš„ `package.json` ä¸­æŒ‡å®šäº† `"packageManager": "pnpm@10.4.1"`ï¼Œè¿™æ„å‘³ç€ï¼š
- æœ‰ `pnpm-lock.yaml` è€Œä¸æ˜¯ `package-lock.json`
- æŸäº›ä¾èµ–å¯èƒ½ä¾èµ– pnpm çš„ç‰¹æ€§
- ä½† v2 è„šæœ¬ä¼šåœ¨ pnpm ä¸å¯ç”¨æ—¶è‡ªåŠ¨ä½¿ç”¨ npm

### Q: è¯Šæ–­è„šæœ¬ä¼šä¿®æ”¹ä»€ä¹ˆå—ï¼Ÿ

**A:** ä¸ä¼šã€‚`find-pnpm.sh` åªè¯»å–ä¿¡æ¯ï¼Œä¸ä¼šä¿®æ”¹ä»»ä½•æ–‡ä»¶æˆ–é…ç½®ã€‚

### Q: å¦‚æœæˆ‘æƒ³ä¿ç•™åŸæ¥çš„è„šæœ¬ï¼Ÿ

**A:** æ²¡é—®é¢˜ï¼ä¸¤ä¸ªè„šæœ¬å¯ä»¥å…±å­˜ï¼š
- `update-standalone.sh` - åŸç‰ˆ
- `update-standalone-v2.sh` - æ–°ç‰ˆ

åªéœ€åœ¨ `.env` ä¸­é€‰æ‹©ä½¿ç”¨å“ªä¸ªï¼š
```env
# ä½¿ç”¨æ–°ç‰ˆï¼ˆæ¨èï¼‰
DEPLOY_SCRIPT=./update-standalone-v2.sh

# æˆ–ä½¿ç”¨åŸç‰ˆ
# DEPLOY_SCRIPT=./update-standalone.sh
```

---

## éªŒè¯æ¸…å•

éƒ¨ç½²æˆåŠŸåï¼Œæ£€æŸ¥ä»¥ä¸‹é¡¹ç›®ï¼š

- [ ] éƒ¨ç½²ç•Œé¢æ— é”™è¯¯æ¶ˆæ¯
- [ ] çœ‹åˆ° "ğŸ‰ ä¸€é”®éƒ¨ç½²æˆåŠŸï¼" æ¨ªå¹…
- [ ] PM2 æ˜¾ç¤º consensuslab è¿›ç¨‹åœ¨è¿è¡Œ
- [ ] èƒ½å¤Ÿè®¿é—®åº”ç”¨ `http://10.218.163.144:3000`
- [ ] åº”ç”¨åŠŸèƒ½æ­£å¸¸

---

## æ€»ç»“

**æ ¸å¿ƒé—®é¢˜**: SSH éäº¤äº’å¼ shell æ‰¾ä¸åˆ° pnpm

**è§£å†³æ–¹æ¡ˆ**: ä½¿ç”¨æ™ºèƒ½æœç´¢çš„ `update-standalone-v2.sh` è„šæœ¬

**æ“ä½œæ­¥éª¤**:
1. è¿è¡Œ `QUICK_FIX.bat` (Windows) æˆ– `QUICK_FIX.sh` (Linux/Mac)
2. é‡å¯éƒ¨ç½²æœåŠ¡
3. ç‚¹å‡»"å¼€å§‹éƒ¨ç½²"æµ‹è¯•

**é¢„æœŸç»“æœ**: éƒ¨ç½²æˆåŠŸï¼Œåº”ç”¨æ­£å¸¸è¿è¡Œ

---

**çŠ¶æ€**: âœ… ä¿®å¤æ–¹æ¡ˆå·²å‡†å¤‡å°±ç»ª
**æ–‡æ¡£**: å®Œæ•´
**æµ‹è¯•**: ç­‰å¾…ç”¨æˆ·åé¦ˆ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æä¾› `find-pnpm.sh` çš„è¾“å‡ºï¼Œæˆ‘ä¼šè¿›ä¸€æ­¥ååŠ©ï¼
